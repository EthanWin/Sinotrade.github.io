<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <base href="https://sinotrade.github.io/">
    <title>Posts</title>

    
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    
    <link href="/css/landing-page.css" rel="stylesheet">

    
    <link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

    <style>
    .navbar {
    border-color: #e7e7e7;
}

.content-section-a,
footer,
.navbar {
  background-color: #f8f8f8;
  color: #333;
}

.navbar a:link,
.navbar-default .navbar-nav>li>a {
  color: #777;
}

.navbar a:hover,
.navbar-default .navbar-nav>li>a:hover {
  color: rgb(51, 51, 51);
}

.content-section-b {
  background-color: white;
  color: #333;
}

body {
  color: rgb(51, 51, 51);
}

.header-container h1,
.header-container h2,
.header-container h3,
.header-container h4 {
  color: rgb(51, 51, 51);
}

  </style>

</head>
<body>

<section id="intro">
	
	<div class="intro-header">

		<div class="container header-container">

			<div class="row">
				<div class="intro-image col-md-4"></div>
				<div class="intro-message col-md-6">
					<h1>Shioaji</h1>
					<h3>Shioaji is sinopac provide the most pythonic api for trading the taiwan and global financial market. You can use your favorite Python packages such as numpy, scipy, pandas, pytorch or tensorflow to build your own trading model with intergrated the shioaji api on cross platform.</h3>

					
					
					

					<iframe class="github-btn" src="https://ghbtns.com/github-btn.html?user=Sinotrade&repo=Shioaji&type=star&count=true&size=large" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
					

					<hr class="intro-divider">
				</div>
			</div>

		</div>
		

	</div>
	
</section>

<section id="services">


 
    
    <div class="content-section-a">
    

        <div class="container">

            <div class="row">
                <div>
                    <hr class="section-heading-spacer">
                    <div class="clearfix"></div>
                    <h2 class="section-heading">Installation</h2>
                    

<h4 id="let-s-get-it">Let&rsquo;s get it</h4>

<p>直接pip install起來，台灣應該沒有其他券商的api那麼方便了。</p>

<pre><code>pip install shioaji
</code></pre>

<p>我們也準備好了docker image給各位直接使用，有需要那些其他的linux distribution歡迎在github上跟我們講。</p>

<pre><code>docker run -it shioaji:latest bash
</code></pre>

<p>這邊沒有在使用docker的可以忽略，docker主要就是幫各位處理好各種環境問題，但是基本上大家應該pip install就可以開了</p>

                </div>
            </div>

        </div>
        

    </div>

    
    <div class="content-section-b">
    

        <div class="container">

            <div class="row">
                <div>
                    <hr class="section-heading-spacer">
                    <div class="clearfix"></div>
                    <h2 class="section-heading">Initialization</h2>
                    <p>上回我們pip install完了以後，接著我們就可以用python, ipython, jupyter notebook或jupyter lab等等之類開始接下來旅程。</p>

<p>在這邊我們還需要一個條件，就是請先開好永豐金證券的帳戶，實體開戶或是直接<a href="http://www.sinotrade.com.tw/">線上開戶</a>。</p>

<p>準備好永豐帳戶就讓我們開始吧!</p>

<p>起手式import我們的api就像import tensorflow pandas等等一樣</p>

<pre><code>import shioaji as sj
</code></pre>

<p>接著我們需要初始化Shioaji這個物件來開始接下來要做的事</p>

<p>python有個很方便的方法可以看這個物件或涵式的文件，就是直接在function或object後面加上?</p>

<blockquote>
<p>input</p>

<pre><code>sj.Shioaji?
</code></pre>

<p>output</p>

<pre><code>Init signature: sj.Shioaji(backend='http', simulation=True, proxies={}, currency='NTD')
Init docstring:
initialize Shioaji to start trading
backend: {http, socket}
    use http or socket as backend currently only support http, socket backend coming soon.
    - http: will support taiwan stock, future, and global stock
    - socket: will support taiwan stock, future and global future
simulation: bool
    - False: to trading on real market (just use your Sinopac account to start trading)
    - True: become simulation account(need to contract as to open simulation account)
proxies: dict
    specific the proxies of your https
    {'https': 'your-proxy-url'}
currency: {NTX, USX, NTD, USD, HKD, EUR, JPY, GBP}
    set the default currency for display 
</code></pre>
</blockquote>

<p>這邊我們選擇http為backend，並且關閉模擬模式，如果有需要使用模擬的客戶麻煩在gitter中聯絡我們，目前我們http比較完整socket會在近日釋出敬請期待。</p>

<blockquote>
<p>input</p>

<pre><code>api = sj.Shioaji(backend='http', simulation=False)
</code></pre>
</blockquote>

<p>接著我們要登入才有辦法開始使用api，登入帳號就是eleader的登入帳號密碼。</p>

<blockquote>
<p>input</p>

<pre><code>api.login?
</code></pre>

<p>output</p>

<pre><code>Signature: api.login(person_id, passwd)
Docstring:
login to trading server
person_id: str
    Same as your eleader, ileader login id(usually your person ID)
passwd: str
    the password of your eleader login password(not ca password)
</code></pre>
</blockquote>

<p>登入後我們會預設抓出第一個期貨帳戶與證券戶作為預設帳戶</p>

<blockquote>
<p>input</p>

<pre><code>api.login(person_id=person_id, passwd='2222')
api.fut_account
</code></pre>

<p>output</p>

<pre><code>{'account': '9104000',
 'username': '莊*芬',
 'datacount': 0,
 'accttype': 'F',
 'broker_id': 'F002000',
 'idno': 'SCCEIEFAJA'}
</code></pre>
</blockquote>

<p>也可以列出我們所有帳戶，使用<code>api.set_default_account</code>將常用設為預設的帳戶</p>

<blockquote>
<p>input</p>

<pre><code>api.list_accounts()
</code></pre>

<p>output</p>

<pre><code>[{'account': '9104000',
  'username': '莊*芬',
  'datacount': 0,
  'accttype': 'F',
  'broker_id': 'F002000',
  'idno': 'SCCEIEFAJA'},
 {'account': '9802195',
  'username': '莊*芬',
  'datacount': 1,
  'accttype': 'S',
  'broker_id': '9A92',
  'idno': 'SCCEIEFAJA'},
 {'account': '09800762',
  'username': 'n*m',
  'datacount': 3,
  'accttype': 'H',
  'broker_id': '1300',
  'idno': 'QCCAHIFFDH'}]
</code></pre>
</blockquote>

<p>以上動作已經完成與下單無關的動作的初始化了，需要下單的話必須啟動憑證，若只是帳務相關等功能無需憑證。</p>

<blockquote>
<p>input</p>

<pre><code>api.activate_ca?
</code></pre>

<p>output</p>

<pre><code>Signature: api.activate_ca(ca_path, ca_passwd, person_id)
Docstring:
activate your ca for trading
ca_path: str
    the path of your ca, support both absloutely and relatively path, use same ca with eleader
ca_passwd: str
    password of your ca
person_id: str
    the ca belong which person ID
</code></pre>

<p>input</p>

<pre><code>api.activate_ca(ca_path='../ca/Sinopac.pfx', ca_passwd='SCCEIEFAJA', person_id=person_id)
</code></pre>

<p>output</p>

<pre><code>Ca Initial Done.
0
</code></pre>
</blockquote>

                </div>
            </div>

        </div>
        

    </div>

    
    <div class="content-section-a">
    

        <div class="container">

            <div class="row">
                <div>
                    <hr class="section-heading-spacer">
                    <div class="clearfix"></div>
                    <h2 class="section-heading">Ordering</h2>
                    <p>開始下單的部分吧!首先我們會需要先製作出Order一筆order物件，然後丟進api的place_order涵式中，這個涵式會回傳一個Trade物件包涵這筆單的狀態。</p>

<p>Order物件需要帶入的參數部分依樣可以用?直接看到文件</p>

<blockquote>
<p>input</p>

<pre><code>api.Order?
</code></pre>

<p>output</p>

<pre><code>Init signature: api.Order(product_id, product_type, opt_type, price, price_type, order_bs, order_type, octype, quantity, account)
Docstring: 
create order object
product_id: str 
    the product code
product_type: {'F', 'O'}
    - F: future
    - O: option
opt_type: {' ', 'C', 'P'}
    the option type Call or Put, leave blank if place future order
    - ' ': Future
    - 'C': Call
    - 'P': Put 
price: float or int
    order price
price_type: {LMT, MKT, MKP}
    - LMT: limit
    - MKT: market
    - MKP: market range
order_bs: {'B', 'S', 
    - 'B': buy
    - 'S': sell
order_type: {ROD, IOC, FOK}
    - ROD: Rest of Day
    - IOC: Immediate-or-Cancel
    - FOK: Fill-or-Kill
octype: {' ', '0', '1', '6'}, 
    - ' ': auto
    - '0': new position
    - '1': close position
    - '6': day trade
quantity: int
</code></pre>
</blockquote>

<p>接這我們有做一件方便大家開發的事，有兩個物件<code>api.Order_props</code>跟<code>api.Contracts</code>這兩個物件可以快速輔助開發的時候直接用tab自動補齊的方式找到Order物件中需要填入的欄位。</p>

<blockquote>
<p>input</p>

<pre><code>api.Order_props.&lt;/tab&gt;
api.Contracts.&lt;/tab&gt;
</code></pre>

<p>這邊我們以期貨為範例按tab鍵自動補齊可交易的合約</p>

<pre><code>api.Contracts.Future.TXF.TXF201903
</code></pre>

<p>output</p>

<pre><code>Contract
    Code: TXFC9
    Detail:
        code: TXFC9
        deliverymonth: 201903
        poc: 
        eprice: 0.0
        ename: TXF
        category: TXF
        prod_kind: I
        csname: 台指期貨
        ostock: #001
        basic: 0001.000000
</code></pre>
</blockquote>

<p>知道使用方式後我們直接用自動補齊的方式幫我快速創建一筆Order，下面這個例子我們可以看到product_id就是用Contracts來填入，其他的參數在Order_props都有相對應的欄位可以幫我們免去用文件的選項輸入，當然也可以直接使用文件的選項直接填入。</p>

<pre><code>sample_order = api.Order(product_id=api.Contracts.Future.TXF.TXF201903.code, 
                         product_type=api.Order_props.product_type.Future, 
                         opt_type=api.Order_props.opt_type.Future,
                         price=9600,
                         price_type=api.Order_props.price_type.LMT,
                         order_bs=api.Order_props.order_bs.Buy,
                         order_type=api.Order_props.order_type.ROD,
                         octype=api.Order_props.octype.auto,
                         quantity=5,
                         account=api.fut_account,
                        )
</code></pre>

<p>接著我們把order物件傳進<code>place_order</code>涵式中就會送出委託單了。</p>

<blockquote>
<p>input</p>

<pre><code>trade = api.place_order(sample_order)
trade
</code></pre>

<p>output</p>

<pre><code>Trade
    status: order_sent
        status_code: 
        errmsg: 
        product_id: TXFC9
        ordno: 
        seqno: 702330
        ord_bs: B
        price: 9600
        quantity: 5
        price_type: LMT
        account: {'account': '9104000', 'username': '莊*芬', 'datacount': 0, 'accttype': 'F', 'broker_id': 'F002000', 'idno': 'SCCEIEFAJA'}
        msg:                                                             
        trade_type: 01
        octype:  
        mttype: 0
        composit: 00
        ord_date: 20181119
        preord_date: 20181119
        ord_time: 15:45:48
        ord_type: ROD
        product_type: F
        opt_type:  
</code></pre>
</blockquote>

<p>拿到的Trade物件我們可以透過<code>update_status</code>涵式來看目前order的狀態</p>

<blockquote>
<p>input</p>

<pre><code>trade.update_status(api.client)
trade
</code></pre>

<p>output</p>

<pre><code>Trade
    status: order_sent
        status_code: 0000
        errmsg: 
        product_id: TXFC9
        ordno: kY012
        seqno: 702330
        ord_bs: B
        price: 9600.0
        quantity: 5
        price_type: LMT
        account: {'account': '9104000', 'username': '莊*芬', 'datacount': 0, 'accttype': 'F', 'broker_id': 'F002000', 'idno': 'SCCEIEFAJA'}
        msg:                                                             
        trade_type: 01
        octype:  
        mttype: 0
        composit: 00
        ord_date: 20181119
        preord_date: 20181119
        ord_time: 15:45:48
        ord_type: ROD
        product_type: F
        opt_type:  
</code></pre>
</blockquote>

<p>改價或改量的部分使用<code>api.update_order</code>涵式傳入Trade物件</p>

<blockquote>
<p>input</p>

<pre><code>trade = api.update_order(trade, price=9800, qty=1)
trade
</code></pre>

<p>output</p>

<pre><code>Trade
    status: order_sent
        status_code: 0000
        errmsg: 
        product_id: TXFC9
        ordno: kY012
        seqno: 702330
        ord_bs: B
        price: 9800.0
        quantity: 5
        price_type: LMT
        account: {'account': '9104000', 'username': '莊*芬', 'datacount': 0, 'accttype': 'F', 'broker_id': 'F002000', 'idno': 'SCCEIEFAJA'}
        msg:                                                             
        trade_type: 01
        octype:  
        mttype: 0
        composit: 00
        ord_date: 20181119
        preord_date: 20181119
        ord_time: 15:45:48
        ord_type: ROD
        product_type: F
        opt_type:  
</code></pre>
</blockquote>

<p>取消委託使用<code>api.cancel_order</code>涵式並傳入欲取消的trade物件，就不寫出範例code了。</p>

                </div>
            </div>

        </div>
        

    </div>

    
    <div class="content-section-b">
    

        <div class="container">

            <div class="row">
                <div>
                    <hr class="section-heading-spacer">
                    <div class="clearfix"></div>
                    <h2 class="section-heading">Account Info</h2>
                    <p>下單ok後來看帳務部分，帳務部份我們為了各位方便的與python的ecosystem結合，我們製作了將帳務的部分做了快速地轉換，就可以快速地變成pandas的Dataframe方便各位與自己的機器學習或深度學習模型直接介接。</p>

                </div>
            </div>

        </div>
        

    </div>


</section>


<footer>
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <p class="copyright text-muted small">Copyright &copy; Sinotrade All Rights Reserved</p>
            </div>
        </div>
    </div>
</footer>

<script src="/js/jquery-1.11.0.js"></script>


<script src="/js/jquery.easing.min.js"></script>


<script src="/js/bootstrap.min.js"></script>


<script src="js/landing-page.js"></script>



</body>
</html>

